<header class="h-20 bg-card border-b border-border flex items-center justify-between px-4 sm:px-6">
  <div class="flex items-center gap-2 sm:gap-4">
    <button (click)="toggleSidebar()" class="p-2 rounded-full hover:bg-muted lg:hidden">
      <span class="material-symbols-outlined text-foreground">menu</span>
    </button>
    <!-- Title and Subtitle -->
    <div>
      <h2 class="text-3xl font-bold text-foreground gradient-text">{{ pageTitle() }}</h2>
      <p class="text-muted-foreground">{{ pageSubtitle() }}</p>
    </div>
  </div>

  <div class="flex items-center space-x-2">
    <button (click)="toggleTheme()" class="p-2 rounded-full hover:bg-muted relative transition-colors">
      <span class="material-symbols-outlined text-foreground">{{ currentTheme() === 'dark' ? 'light_mode' : 'dark_mode' }}</span>
    </button>
    <button (click)="handleNotificationClick($event)" pButton pRipple class="p-2 rounded-full hover:bg-muted relative transition-colors p-button-text p-button-plain">
      <span class="material-symbols-outlined text-foreground">notifications</span>
      <span
        *ngIf="unreadNotificationCount() > 0"
        class="absolute top-1 right-1 block h-5 w-5 rounded-full bg-destructive shadow-glow-destructive flex items-center justify-center text-xs text-white"
      >{{ unreadNotificationCount() }}</span>
    </button>
    <p-menu #notificationMenu [model]="notificationMenuItems()" [popup]="true" styleClass="notification-menu-custom">
      <ng-template pTemplate="start">
        <div class="flex items-center justify-between px-6 py-4 bg-muted/30">
          <h2 class="text-foreground text-base font-semibold">{{ 'NOTIFICATIONS.TITLE' | translate }}</h2>
          <button (click)="markAllNotificationsAsRead()" class="text-primary text-sm font-medium hover:shadow-glow-primary transition-shadow duration-300 rounded-md">
            {{ 'NOTIFICATIONS.MARK_ALL_AS_READ' | translate }}
          </button>
        </div>
      </ng-template>
      <ng-template pTemplate="item" let-item>
        @if (item.data) {
          <a class="p-menuitem-link" (click)="item.command()">
            <div class="flex items-start gap-4 px-6 py-4 hover:bg-muted transition-colors cursor-pointer w-full">
              <div class="mt-1.5 size-2 shrink-0 rounded-full" [ngClass]="{'bg-primary glow-dot': !item.data.isRead, 'bg-transparent': item.data.isRead}"></div>
              <div class="flex items-start gap-4">
                <div class="flex items-center justify-center rounded-full bg-muted shrink-0 size-10" [ngClass]="{'text-primary': !item.data.isRead, 'text-muted-foreground': item.data.isRead}">
                  <span class="material-symbols-outlined text-xl">notifications_active</span>
                </div>
                <div class="flex flex-col gap-0.5 text-left">
                  <p class="text-sm" [ngClass]="{'text-foreground font-bold': !item.data.isRead, 'text-foreground/80': item.data.isRead}">{{ item.data.message }}</p>
                  <p class="text-muted-foreground text-xs font-normal">{{ item.data.createdAt | date:'shortTime' }}</p>
                </div>
              </div>
            </div>
          </a>
        } @else {
          <div class="text-center text-muted-foreground p-10">
            <p>{{ item.label }}</p>
          </div>
        }
      </ng-template>
      <ng-template pTemplate="end">
        <div class="flex items-center justify-center px-4 py-3 bg-muted/30 border-t border-border">
          <a (click)="onViewAllNotifications()" class="text-primary text-sm font-medium hover:shadow-glow-primary transition-shadow duration-300 rounded-md px-2 py-1 cursor-pointer">
            {{ 'HEADER.NOTIFICATIONS.VIEW_ALL' | translate }}
          </a>
        </div>
      </ng-template>
    </p-menu>

    <!-- User Profile Dropdown -->
    <div *ngIf="userProfile()">
      <button type="button" pButton pRipple class="p-button-text p-button-plain" (click)="menu.toggle($event)">
        <div class="flex items-center space-x-2">
          <!-- Avatar with Initials -->
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-blue-400 flex items-center justify-center text-white font-semibold text-sm">
            {{ getUserInitials() }}
          </div>
          <div>
            <p class="font-semibold text-foreground text-sm hidden sm:block">{{ userProfile()!.name }}</p>
            <p class="font-semibold text-foreground text-sm sm:hidden">{{ userProfile()!.role | translate }}</p>
            <p class="text-xs text-muted-foreground hidden sm:block">{{ userProfile()!.email }}</p>
          </div>
        </div>
      </button>
      <p-menu #menu [model]="menuItems" [popup]="true"></p-menu>
    </div>
  </div>
</header>
