<div class="flex flex-col h-full gap-6">
  <div>
    <app-filter-bar></app-filter-bar>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
    <div class="xl:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div
        class="lg:col-span-1 bg-card p-6 rounded-lg border border-border relative overflow-hidden"
      >
        <div class="absolute inset-0 bg-gradient-to-br from-card to-secondary/20 opacity-50"></div>
        <div class="relative z-10">
          <h3
            class="font-bold text-xl mb-4 text-foreground"
            style="text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5)"
          >
            Distribución de Alertas
          </h3>
          <app-alert-distribution-chart></app-alert-distribution-chart>
        </div>
      </div>

      <div
        class="bg-card p-6 rounded-lg border border-border lg:col-span-2 relative overflow-hidden"
      >
        <div class="absolute inset-0 bg-gradient-to-br from-card to-secondary/20 opacity-50"></div>
        <div class="relative z-10">
          <h3
            class="font-bold text-xl mb-4 text-foreground"
            style="text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5)"
          >
            Top 5 Conductores con Más Alertas
          </h3>
          <app-top-drivers-chart></app-top-drivers-chart>
        </div>
      </div>

      <div
        class="bg-card p-6 rounded-lg border border-border lg:col-span-3 relative overflow-hidden"
      >
        <div class="absolute inset-0 bg-gradient-to-br from-card to-secondary/20 opacity-50"></div>
        <div class="relative z-10">
          <h3
            class="font-bold text-xl mb-4 text-foreground"
            style="text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5)"
          >
            Línea de Tiempo de Eventos Críticos
          </h3>
          <app-critical-events-timeline></app-critical-events-timeline>
        </div>
      </div>
    </div>

    <div class="xl:col-span-1">
      <div
        class="bg-card rounded-lg border border-border overflow-hidden relative flex flex-col h-full"
      >
        <div class="absolute inset-0 bg-gradient-to-b from-secondary/10 to-card"></div>
        <div class="relative z-10 p-6">
          <h3
            class="font-bold text-xl text-foreground"
            style="text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5)"
          >
            Eventos Recientes
          </h3>
        </div>
        <div class="relative z-10 flex-1 overflow-y-auto px-6 pb-6 space-y-4 min-h-0" style="max-height: 500px;">
          @for (event of recentEvents(); track event.id) {
          <div class="flex items-start space-x-4">
            <div
              class="w-10 h-10 flex-shrink-0 rounded-full flex items-center justify-center border"
              [ngClass]="
                getEventAppearance(event).colorClass +
                '/10 ' +
                getEventAppearance(event).colorClass.replace('text-', 'border-') +
                '/30'
              "
            >
              <span
                class="material-symbols-outlined text-xl"
                [ngClass]="getEventAppearance(event).colorClass"
                [style.text-shadow]="
                  '0 0 8px hsl(var(--' +
                  getEventAppearance(event).colorClass.replace('text-', '') +
                  '-glow) / 0.7)'
                "
              >
                {{ getEventAppearance(event).icon }}
              </span>
            </div>
            <div>
              <p class="font-semibold text-foreground">{{ event.fatigueType | titlecase }}</p>
              <p class="text-sm text-muted-foreground">
                {{ event.driverName }} | {{ event.vehicleIdentifier }}
              </p>
              <p class="text-xs text-muted-foreground/70 mt-1">{{ event.timestamp | timeAgo }}</p>
            </div>
          </div>
          } @empty {
          <div class="text-center text-muted-foreground py-10">
            <span class="material-symbols-outlined text-4xl mb-2">radar</span>
            <p>Esperando nuevos eventos...</p>
          </div>
          }
        </div>
        <div class="relative z-10 p-6 mt-auto border-t border-border">
          <button
            [routerLink]="['/monitoring/live']"
            class="w-full text-center text-primary hover:text-primary/80 font-semibold transition-colors"
          >
            Ver todas las alertas
          </button>
        </div>
      </div>
    </div>
  </div>

  <div>
    <app-fleet-summary-table></app-fleet-summary-table>
  </div>
</div>
