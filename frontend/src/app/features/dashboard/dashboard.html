<div class="dashboard-container flex flex-col h-full gap-6">
  <div>
    <app-filter-bar></app-filter-bar>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
    <div class="xl:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div
        class="chart-container lg:col-span-1 bg-card p-6 rounded-lg border border-border relative overflow-hidden"
      >
        <div class="absolute inset-0 bg-gradient-to-br from-card to-secondary/15 opacity-30"></div>
        <div class="relative z-10">
          <h3
            class="font-bold text-xl mb-4 text-foreground"
            style="text-shadow: none;"
          >
            {{ 'DASHBOARD.ALERT_DISTRIBUTION' | translate }}
          </h3>
          <app-alert-distribution-chart></app-alert-distribution-chart>
        </div>
      </div>

      <div
        class="chart-container bg-card p-6 rounded-lg border border-border lg:col-span-2 relative overflow-hidden"
      >
        <div class="absolute inset-0 bg-gradient-to-br from-card to-secondary/15 opacity-30"></div>
        <div class="relative z-10">
          <h3
            class="font-bold text-xl mb-4 text-foreground"
            style="text-shadow: none;"
          >
            {{ 'DASHBOARD.TOP_DRIVERS' | translate }}
          </h3>
          <app-top-drivers-chart></app-top-drivers-chart>
        </div>
      </div>

      <div
        class="chart-container bg-card p-6 rounded-lg border border-border lg:col-span-3 relative overflow-hidden"
      >
        <div class="absolute inset-0 bg-gradient-to-br from-card to-secondary/15 opacity-30"></div>
        <div class="relative z-10">
          <h3
            class="font-bold text-xl mb-4 text-foreground"
            style="text-shadow: none;"
          >
            {{ 'DASHBOARD.CRITICAL_EVENTS_TIMELINE' | translate }}
          </h3>
          <app-critical-events-timeline></app-critical-events-timeline>
        </div>
      </div>
    </div>

    <div class="xl:col-span-1">
      <div
        class="recent-events-container bg-card rounded-lg border border-border overflow-hidden relative flex flex-col h-full"
      >
        <div class="absolute inset-0 bg-gradient-to-b from-secondary/5 to-card opacity-20"></div>
        <div class="relative z-10 p-6">
          <h3
            class="font-bold text-xl text-foreground"
            style="text-shadow: none;"
          >
            {{ 'DASHBOARD.RECENT_EVENTS' | translate }}
          </h3>
        </div>
        <div class="relative z-10 flex-1 overflow-y-auto px-6 pb-6 space-y-4 min-h-0" style="max-height: 500px;">
          @for (event of recentEvents(); track event.id) {
          <div class="event-item">
            <div
              class="event-icon"
              [ngClass]="
                getEventAppearance(event).colorClass +
                '/20 ' +
                getEventAppearance(event).colorClass.replace('text-', 'border-') +
                '/40'
              "
            >
              <span
                class="material-symbols-outlined text-xl"
                [ngClass]="getEventAppearance(event).colorClass"
                [style.filter]="
                  'drop-shadow(0 0 4px hsl(var(--' +
                  getEventAppearance(event).colorClass.replace('text-', '') +
                  ')/0.5))'
                "
              >
                {{ getEventAppearance(event).icon }}
              </span>
            </div>
            <div class="event-content">
              <p class="event-title">{{ event.fatigueType | titlecase }}</p>
              <p class="event-subtitle">
                {{ event.driverName }} | {{ event.vehicleIdentifier }}
              </p>
              <p class="event-time">{{ event.timestamp | timeAgo }}</p>
            </div>
          </div>
          } @empty {
          <div class="text-center text-muted-foreground py-10">
            <span class="material-symbols-outlined text-4xl mb-2">radar</span>
            <p>{{ 'DASHBOARD.WAITING_FOR_EVENTS' | translate }}</p>
          </div>
          }
        </div>
        <div class="relative z-10 p-6 mt-auto border-t border-border">
          <button
            [routerLink]="['/monitoring/live']"
            class="view-all-button"
          >
            {{ 'DASHBOARD.VIEW_ALL_ALERTS' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <div>
    <app-fleet-summary-table></app-fleet-summary-table>
  </div>
</div>
