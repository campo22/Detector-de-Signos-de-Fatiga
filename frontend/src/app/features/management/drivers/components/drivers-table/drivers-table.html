<!-- Contenedor principal con estilos de tarjeta para la tabla de conductores -->
<div
  class="bg-card rounded-xl shadow-2xl overflow-hidden border border-border flex flex-col h-full"
>
  <!-- Contenedor que permite el desplazamiento horizontal de la tabla si el contenido es demasiado ancho -->
  <div class="overflow-x-auto flex-1 custom-scrollbar">
    <!-- Tabla principal que muestra la lista de conductores -->
    <table class="w-full text-sm text-left text-muted-foreground">
      <!-- Encabezado de la tabla, se mantiene fijo en la parte superior al hacer scroll -->
      <thead
        class="text-xs text-muted-foreground uppercase bg-secondary/30 backdrop-blur-sm sticky top-0 z-10"
      >
        <tr>
          <!-- Columna: Nombre. Permite ordenar los datos al hacer clic. -->
          <th
            scope="col"
            class="px-6 py-3 cursor-pointer hover:text-primary transition-colors"
            (click)="changeSort('nombre')"
          >
            {{ 'DRIVERS.TABLE.HEADER_NAME' | translate }}
            <!-- Muestra un ícono de flecha para indicar el orden si esta columna está activa -->
            @if(sortState().column === 'nombre'){
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
            }
          </th>
          <!-- Columna: ID -->
          <th scope="col" class="px-6 py-3">{{ 'DRIVERS.TABLE.HEADER_ID' | translate }}</th>
          <!-- Columna: Licencia. Permite ordenar los datos al hacer clic. -->
          <th
            scope="col"
            class="px-6 py-3 cursor-pointer hover:text-primary transition-colors"
            (click)="changeSort('licencia')"
          >
            {{ 'DRIVERS.TABLE.HEADER_LICENSE' | translate }}
            <!-- Muestra un ícono de flecha para indicar el orden si esta columna está activa -->
            @if(sortState().column === 'licencia'){
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
            }
          </th>
          <!-- Columna: Estado. Permite ordenar los datos al hacer clic. -->
          <th
            scope="col"
            class="px-6 py-3 cursor-pointer hover:text-primary transition-colors"
            (click)="changeSort('activo')"
          >
            {{ 'DRIVERS.TABLE.HEADER_STATUS' | translate }}
            <!-- Muestra un ícono de flecha para indicar el orden si esta columna está activa -->
            @if(sortState().column === 'activo'){
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
            }
          </th>
          <!-- Columna: Vehículo Asignado -->
          <!-- <th scope="col" class="px-6 py-3">Vehículo Asignado</th> -->
          <!-- Columna: Acciones -->
          <th scope="col" class="px-6 py-3 text-center">{{ 'DRIVERS.TABLE.HEADER_ACTIONS' | translate }}</th>
        </tr>
      </thead>

      <!-- Cuerpo de la tabla: se muestra solo si hay datos de conductores disponibles -->
      @if (driversPage(); as page) {
      <tbody>
        <!-- Itera sobre cada conductor en la página actual para crear una fila -->
        @for (driver of page.content; track driver.id; let i = $index) {
        <tr
          class="bg-card border-b border-border even:bg-secondary/20 hover:bg-muted/40 transition-colors driver-row"
          [style.animation-delay]="i * 40 + 'ms'"
        >
          <!-- Celda: Nombre del conductor -->
          <td class="px-6 py-4 font-medium text-foreground whitespace-nowrap">
            {{ driver.nombre }}
          </td>
          <!-- Celda: ID del conductor con botón de copiado -->
          <td class="px-6 py-4 font-mono text-xs">
            <div class="flex items-center gap-2">
              <span>{{ driver.id.substring(0, 8) }}...</span>
              <button
                [cdkCopyToClipboard]="driver.id"
                (cdkCopyToClipboardCopied)="onIdCopied(driver.id)"
                [pTooltip]="'DRIVERS.TABLE.COPY_ID_TOOLTIP' | translate"
                tooltipPosition="top"
                class="p-1 rounded-md hover:bg-primary/10 text-primary transition-colors"
              >
                <span class="material-symbols-outlined text-sm">content_copy</span>
              </button>
            </div>
          </td>
          <!-- Celda: Licencia del conductor -->
          <td class="px-6 py-4">{{ driver.licencia }}</td>
          <!-- Celda: Estado del conductor (Activo/Inactivo) -->
          <td class="px-6 py-4">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
              [ngClass]="
                driver.activo
                  ? 'status-active bg-success/10 text-success'
                  : 'status-inactive bg-destructive/10 text-destructive'
              "
            >
              <!-- Indicador visual de estado (punto de color) -->
              <span
                class="w-2 h-2 mr-1.5 rounded-full"
                [ngClass]="driver.activo ? 'bg-success' : 'bg-destructive'"
              ></span>
              <!-- Texto del estado -->
              {{ driver.activo ? ('DRIVERS.STATUS_ACTIVE' | translate) : ('DRIVERS.STATUS_INACTIVE' | translate) }}
            </span>
          </td>
          <!-- Celda: Vehículo Asignado (actualmente un valor estático) -->
          <!-- <td class="px-6 py-4">N/A</td> -->
          <!-- Celda: Botones de acción -->
          <td class="px-6 py-4 text-center" style="overflow: visible">
            <div class="flex items-center justify-center gap-4">
              <!-- Botón para editar el conductor -->
              <div class="group relative flex items-center">
                <button
                  (click)="onEditDriver(driver)"
                  [title]="'DRIVERS.TABLE.EDIT_TOOLTIP' | translate"
                  class="p-3 rounded-full text-primary hover:bg-primary/10 transition-all duration-200"
                >
                  <span class="material-symbols-outlined text-xl">edit</span>
                </button>
                <div
                  class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-auto px-3 py-1.5 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none dark:bg-gray-700 whitespace-nowrap z-50"
                >
                  {{ 'DRIVERS.TABLE.EDIT_TOOLTIP' | translate }}
                </div>
              </div>
              <!-- Botón para ver los detalles del conductor -->
              <div class="group relative flex items-center">
                <button
                  (click)="viewDriverDetails(driver.id)"
                  [title]="'DRIVERS.TABLE.VIEW_DETAILS_TOOLTIP' | translate"
                  class="p-3 rounded-full text-success hover:bg-success/10 transition-all duration-200"
                >
                  <span class="material-symbols-outlined text-xl">visibility</span>
                </button>
                <div
                  class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-auto px-3 py-1.5 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none dark:bg-gray-700 whitespace-nownowrap z-50"
                >
                  {{ 'DRIVERS.TABLE.VIEW_DETAILS_TOOLTIP' | translate }}
                </div>
              </div>
              <!-- Botón para eliminar el conductor -->
              <div class="group relative flex items-center">
                <button
                  (click)="onDeleteDriver(driver)"
                  [title]="'DRIVERS.TABLE.DELETE_TOOLTIP' | translate"
                  class="p-3 rounded-full text-destructive hover:bg-destructive/10 transition-all duration-200"
                >
                  <span class="material-symbols-outlined text-xl">delete</span>
                </button>
                <div
                  class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-auto px-3 py-1.5 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none dark:bg-gray-700 whitespace-nowrap z-50"
                >
                  {{ 'DRIVERS.TABLE.DELETE_TOOLTIP' | translate }}
                </div>
              </div>
            </div>
          </td>
        </tr>
        }
      </tbody>
      }
    </table>

    <!-- Mensaje que se muestra si no se encontraron conductores después de aplicar filtros -->
    @if (driversPage() !== null && driversPage()?.content?.length === 0) {
    <div class="text-center text-muted-foreground p-20">
      <div class="flex flex-col items-center justify-center gap-4">
        <span class="material-symbols-outlined text-6xl text-primary">person_search</span>
        <h3 class="text-xl font-semibold">{{ 'DRIVERS.TABLE.NO_DRIVERS_FOUND_TITLE' | translate }}</h3>
        <p>{{ 'DRIVERS.TABLE.NO_DRIVERS_FOUND_SUBTITLE' | translate }}</p>
      </div>
    </div>
    }
    <!-- Indicador de carga que se muestra mientras se obtienen los datos -->
    @if (driversPage() === null) {
    <div class="flex flex-col items-center justify-center text-muted-foreground p-20 gap-4">
      <span class="material-symbols-outlined text-6xl animate-spin text-primary"
        >progress_activity</span
      >
      <p class="text-lg">{{ 'DRIVERS.TABLE.LOADING' | translate }}</p>
    </div>
    }
  </div>

  <!-- Navegación de paginación: se muestra solo si hay datos de conductores disponibles -->
  @if (driversPage(); as page) {
  <nav
    aria-label="Table navigation"
    class="flex flex-col sm:flex-row items-center justify-between p-4 border-t border-border gap-3"
  >
    <!-- Muestra el recuento de elementos actuales y totales -->
    <span class="text-sm font-normal text-muted-foreground">
      {{ 'DRIVERS.TABLE.PAGINATION_SHOWING' | translate }} <span class="font-semibold text-foreground">{{ page.numberOfElements }}</span> {{ 'DRIVERS.TABLE.PAGINATION_OF' | translate }}
      <span class="font-semibold text-foreground">{{ page.totalElements }}</span>
    </span>
    <!-- Lista de controles de paginación -->
    <ul class="inline-flex items-center -space-x-px text-sm h-8">
      <li>
        <!-- Botón para ir a la página anterior -->
        <button
          (click)="previousPage()"
          [disabled]="page.first"
          class="flex items-center justify-center px-3 h-8 ml-0 leading-tight text-muted-foreground bg-card border border-border rounded-l-lg hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        >
          <span class="material-symbols-outlined text-base">chevron_left</span>
        </button>
      </li>
      <!-- Muestra el número de página actual y el total de páginas -->
      <li class="px-3 h-8 flex items-center text-muted-foreground bg-card border-y border-border">
        {{ 'DRIVERS.TABLE.PAGINATION_PAGE' | translate }} {{ page.number + 1 }} {{ 'DRIVERS.TABLE.PAGINATION_OF' | translate }} {{ page.totalPages }}
      </li>
      <li>
        <!-- Botón para ir a la página siguiente -->
        <button
          (click)="nextPage()"
          [disabled]="page.last"
          class="flex items-center justify-center px-3 h-8 leading-tight text-muted-foreground bg-card border border-border rounded-r-lg hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        >
          <span class="material-symbols-outlined text-base">chevron_right</span>
        </button>
      </li>
    </ul>
  </nav>
  }
</div>
