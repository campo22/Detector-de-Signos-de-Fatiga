<div class="overflow-x-auto flex-1 custom-scrollbar">
  <table class="w-full text-sm text-left text-muted-foreground">
    <thead class="text-xs text-muted-foreground uppercase bg-secondary/30 backdrop-blur-sm sticky top-0 z-10">
      <tr>
        <th scope="col" class="px-6 py-3 cursor-pointer hover:text-primary transition-colors" (click)="onChangeSort('name')">
          Nombre
          @if (sortState().column === 'name') {
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
          }
        </th>
        <th scope="col" class="px-6 py-3 cursor-pointer hover:text-primary transition-colors" (click)="onChangeSort('email')">
          Email
          @if (sortState().column === 'email') {
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
          }
        </th>
        <th scope="col" class="px-6 py-3 cursor-pointer hover:text-primary transition-colors" (click)="onChangeSort('rol')">
          Rol
          @if (sortState().column === 'rol') {
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
          }
        </th>
        <th scope="col" class="px-6 py-3 cursor-pointer hover:text-primary transition-colors" (click)="onChangeSort('activo')">
          Estado
          @if (sortState().column === 'activo') {
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
          }
        </th>
        <th scope="col" class="px-6 py-3 text-center">Acciones</th>
      </tr>
    </thead>

    @if (usersPage(); as page) {
      <tbody>
        @for (user of page.content; track user.id; let i = $index) {
          <tr class="bg-card border-b border-border even:bg-secondary/20 hover:bg-muted/40 transition-colors user-row" [style.animation-delay]="i * 40 + 'ms'">
            <td class="px-6 py-4 font-medium text-foreground whitespace-nowrap">{{ user.name }}</td>
            <td class="px-6 py-4">{{ user.email }}</td>
            <td class="px-6 py-4">{{ user.rol }}</td>
            <td class="px-6 py-4">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" [ngClass]="user.activo ? 'status-active bg-success/10 text-success' : 'status-inactive bg-destructive/10 text-destructive'">
                <span class="w-2 h-2 mr-1.5 rounded-full" [ngClass]="user.activo ? 'bg-success' : 'bg-destructive'"></span>
                {{ user.activo ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td class="px-6 py-4 text-center">
              <div class="flex items-center justify-center gap-4">
                <button (click)="onEdit(user)" title="Editar" class="p-3 rounded-full text-primary hover:bg-primary/10 transition-all duration-200">
                  <span class="material-symbols-outlined text-xl">edit</span>
                </button>
                <button (click)="onDelete(user)" title="Eliminar" class="p-3 rounded-full text-destructive hover:bg-destructive/10 transition-all duration-200">
                  <span class="material-symbols-outlined text-xl">delete</span>
                </button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    }
  </table>

  @if (usersPage() !== null && usersPage()?.content?.length === 0) {
    <div class="text-center text-muted-foreground p-20">
      <div class="flex flex-col items-center justify-center gap-4">
        <span class="material-symbols-outlined text-6xl text-primary">person_search</span>
        <h3 class="text-xl font-semibold">No se encontraron usuarios</h3>
        <p>Intenta ajustar los filtros para encontrar lo que buscas.</p>
      </div>
    </div>
  }

  @if (usersPage() === null) {
    <div class="flex flex-col items-center justify-center text-muted-foreground p-20 gap-4">
      <span class="material-symbols-outlined text-6xl animate-spin text-primary">progress_activity</span>
      <p class="text-lg">Cargando usuarios...</p>
    </div>
  }
</div>

@if (usersPage(); as page) {
  <nav aria-label="Table navigation" class="flex flex-col sm:flex-row items-center justify-between p-4 border-t border-border gap-3">
    <span class="text-sm font-normal text-muted-foreground">
      Mostrando <span class="font-semibold text-foreground">{{ page.numberOfElements }}</span> de
      <span class="font-semibold text-foreground">{{ page.totalElements }}</span>
    </span>
    <ul class="inline-flex items-center -space-x-px text-sm h-8">
      <li>
        <button (click)="onChangePage('prev')" [disabled]="page.first" class="flex items-center justify-center px-3 h-8 ml-0 leading-tight text-muted-foreground bg-card border border-border rounded-l-lg hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          <span class="material-symbols-outlined text-base">chevron_left</span>
        </button>
      </li>
      <li class="px-3 h-8 flex items-center text-muted-foreground bg-card border-y border-border">
        PÃ¡g {{ page.number + 1 }} de {{ page.totalPages }}
      </li>
      <li>
        <button (click)="onChangePage('next')" [disabled]="page.last" class="flex items-center justify-center px-3 h-8 leading-tight text-muted-foreground bg-card border border-border rounded-r-lg hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          <span class="material-symbols-outlined text-base">chevron_right</span>
        </button>
      </li>
    </ul>
  </nav>
}