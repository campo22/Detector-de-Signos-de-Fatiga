<div
  class="bg-card rounded-xl shadow-2xl overflow-hidden border border-border flex flex-col h-full"
>
  <div class="overflow-x-auto flex-1 custom-scrollbar">
    <table class="w-full text-sm text-left text-muted-foreground">
      <thead
        class="text-xs text-muted-foreground uppercase bg-secondary/30 backdrop-blur-sm sticky top-0 z-10"
      >
        <tr>
          <!-- Columna ID -->
          <th scope="col" class="px-6 py-3">ID</th>
          <th
            scope="col"
            class="px-6 py-3 cursor-pointer hover:text-primary transition-colors"
            (click)="changeSort('placa')"
          >
            Placa @if(sortState().column === 'placa'){
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
            }
          </th>

          <th
            scope="col"
            class="px-6 py-3 cursor-pointer hover:text-primary transition-colors"
            (click)="changeSort('marca')"
          >
            Marca @if(sortState().column === 'marca'){
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
            }
          </th>

          <th
            scope="col"
            class="px-6 py-3 cursor-pointer hover:text-primary transition-colors"
            (click)="changeSort('modelo')"
          >
            Modelo @if(sortState().column === 'modelo'){
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
            }
          </th>

          <th
            scope="col"
            class="px-6 py-3 cursor-pointer hover:text-primary transition-colors"
            (click)="changeSort('anio')"
          >
            Año @if(sortState().column === 'anio'){
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
            }
          </th>

          <th
            scope="col"
            class="px-6 py-3 cursor-pointer hover:text-primary transition-colors"
            (click)="changeSort('activo')"
          >
            Estado @if(sortState().column === 'activo'){
            <span class="material-symbols-outlined text-sm align-middle ml-1">
              {{ sortState().direction === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
            </span>
            }
          </th>

          <th scope="col" class="px-6 py-3">Conductor Asignado</th>

          <th scope="col" class="px-6 py-3 text-center">Acciones</th>
        </tr>
      </thead>
      @if (vehiclesPage(); as page) {
      <tbody>
        @for (vehicle of page.content; track vehicle.id; let i = $index) {
        <tr
          class="bg-card border-b border-border even:bg-secondary/20 hover:bg-muted/40 transition-colors driver-row"
          [style.animation-delay]="i * 40 + 'ms'"
        >
          <!-- Celda ID del vehículo con botón de copiado -->
          <td class="px-6 py-4 font-mono text-xs">
            <div class="flex items-center gap-2">
              <span>{{ vehicle.id.substring(0, 8) }}...</span>
              <button
                [cdkCopyToClipboard]="vehicle.id"
                (cdkCopyToClipboardCopied)="onIdCopied(vehicle.id)"
                pTooltip="Copiar ID completo"
                tooltipPosition="top"
                class="p-1 rounded-md hover:bg-primary/10 text-primary transition-colors"
              >
                <span class="material-symbols-outlined text-sm">content_copy</span>
              </button>
            </div>
          </td>
          <td class="px-6 py-4 font-medium text-foreground whitespace-nowrap">
            {{ vehicle.placa }}
          </td>

          <td class="px-6 py-4">{{ vehicle.marca }}</td>

          <td class="px-6 py-4">{{ vehicle.modelo || 'N/A' }}</td>

          <td class="px-6 py-4">{{ vehicle.anio }}</td>

          <td class="px-6 py-4">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
              [ngClass]="
                vehicle.activo
                  ? 'status-active bg-success/10 text-success'
                  : 'status-inactive bg-destructive/10 text-destructive'
              "
            >
              <span
                class="w-2 h-2 mr-1.5 rounded-full"
                [ngClass]="vehicle.activo ? 'bg-success' : 'bg-destructive'"
              ></span>
              {{ vehicle.activo ? 'Activo' : 'Inactivo' }}
            </span>
          </td>

          <td class="px-6 py-4">
            @if (vehicle.driver) {
            <div class="flex items-center gap-2">
              <span>{{ vehicle.driver.nombre }}</span>
              <button
                [cdkCopyToClipboard]="vehicle.driver.id"
                (cdkCopyToClipboardCopied)="onIdCopied(vehicle.driver.id)"
                pTooltip="Copiar ID del Conductor"
                tooltipPosition="top"
                class="p-1 rounded-md hover:bg-primary/10 text-primary transition-colors"
              >
                <span class="material-symbols-outlined text-sm">content_copy</span>
              </button>
            </div>
            } @else {
            <span class="text-muted-foreground/70">Sin Asignar</span>
            }
          </td>

          <td class="px-6 py-4 text-center" style="overflow: visible">
            <div class="flex items-center justify-center gap-4">
              <!-- Botón para editar el vehículo -->
              <div class="group relative flex items-center">
                <button
                  (click)="onEditVehicle(vehicle)"
                  title="Editar"
                  class="p-3 rounded-full text-primary hover:bg-primary/10 transition-all duration-200"
                >
                  <span class="material-symbols-outlined text-xl">edit</span>
                </button>
                <div
                  class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-auto px-3 py-1.5 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none dark:bg-gray-700 whitespace-nowrap z-50"
                >
                  Editar Vehículo
                </div>
              </div>
              <!-- Botón para eliminar el vehículo -->
              <div class="group relative flex items-center">
                <button
                  (click)="onDeleteVehicle(vehicle)"
                  title=" Eliminar"
                  class="p-3 rounded-full text-destructive hover:bg-destructive/10 transition-all duration-200"
                >
                  <span class="material-symbols-outlined text-xl">delete</span>
                </button>
                <div
                  class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-auto px-3 py-1.5 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none dark:bg-gray-700 whitespace-nowrap z-50"
                >
                  Eliminar
                </div>
              </div>
            </div>
          </td>
        </tr>
        }
      </tbody>
      }
    </table>

    <!-- Mensaje que se muestra si no se encontraron vehículos después de aplicar filtros -->
    @if (vehiclesPage() !== null && vehiclesPage()?.content?.length === 0) {
    <div class="text-center text-muted-foreground p-20">
      <div class="flex flex-col items-center justify-center gap-4">
        <span class="material-symbols-outlined text-6xl text-primary">no_crash</span>
        <h3 class="text-xl font-semibold">No se encontraron vehículos</h3>
        <p>Intenta ajustar los filtros para encontrar lo que buscas.</p>
      </div>
    </div>
    }
    <!-- Indicador de carga que se muestra mientras se obtienen los datos -->
    @if (vehiclesPage() === null) {
    <div class="flex flex-col items-center justify-center text-muted-foreground p-20 gap-4">
      <span class="material-symbols-outlined text-6xl animate-spin text-primary"
        >progress_activity</span
      >
      <p class="text-lg">Cargando vehículos...</p>
    </div>
    }
  </div>
  @if (vehiclesPage(); as page) {
  <nav
    aria-label="Navegación de la tabla"
    class="flex flex-col sm:flex-row items-center justify-between p-4 border-t border-border gap-3"
  >
    <span class="text-sm font-normal text-muted-foreground">
      Mostrando <span class="font-semibold text-foreground">{{ page.numberOfElements }}</span> de
      <span class="font-semibold text-foreground">{{ page.totalElements }}</span>
    </span>

    <ul class="inline-flex items-center -space-x-px text-sm h-8">
      <li>
        <button
          (click)="previousPage()"
          [disabled]="page.first"
          class="flex items-center justify-center px-3 h-8 ml-0 leading-tight text-muted-foreground bg-card border border-border rounded-l-lg hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        >
          <span class="material-symbols-outlined text-base">chevron_left</span>
        </button>
      </li>
      <li class="px-3 h-8 flex items-center text-muted-foreground bg-card border-y border-border">
        Pág {{ page.number + 1 }} de {{ page.totalPages }}
      </li>
      <li>
        <button
          (click)="nextPage()"
          [disabled]="page.last"
          class="flex items-center justify-center px-3 h-8 leading-tight text-muted-foreground bg-card border border-border rounded-r-lg hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        >
          <span class="material-symbols-outlined text-base">chevron_right</span>
        </button>
      </li>
    </ul>
  </nav>
  }
</div>
