<form [formGroup]="vehicleForm" (ngSubmit)="onSubmit()" class="space-y-6">
  @if (errorMessage(); as msg) {
  <div
    class="mb-4 p-3 bg-destructive/10 border border-destructive/30 text-destructive text-sm rounded-md"
  >
    {{ msg }}
  </div>
  }

  <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
    <!-- Placa -->
    <div class="space-y-2 input-field">
      <label
        for="placa"
        class="flex items-center gap-2 font-display text-sm font-medium leading-none text-muted-foreground transition-colors duration-300"
      >
        <span class="material-symbols-outlined text-lg transition-all duration-300">pin</span>
        Placa
      </label>
      <input
        id="placa"
        type="text"
        pInputText
        formControlName="placa"
        placeholder="Ej: ABC-123"
        class="font-mono flex h-11 w-full rounded-md border border-border bg-input px-3 py-2 text-sm placeholder:text-muted-foreground/60 transition-all duration-300 focus:border-primary/60 focus:bg-background focus:outline-none focus:ring-2 focus:ring-ring/50 focus:ring-offset-2 focus:ring-offset-background"
      />
      @if (isInvalid('placa')) {
      <div class="flex items-center gap-2 text-red-600 text-xs mt-1">
        <span class="material-symbols-outlined text-sm">error</span>
        <span>Placa es requerida.</span>
      </div>
      }
    </div>

    <!-- Marca -->
    <div class="space-y-2 input-field">
      <label
        for="marca"
        class="flex items-center gap-2 font-display text-sm font-medium leading-none text-muted-foreground transition-colors duration-300"
      >
        <span class="material-symbols-outlined text-lg transition-all duration-300"
          >directions_car</span
        >
        Marca
      </label>
      <input
        id="marca"
        type="text"
        pInputText
        formControlName="marca"
        placeholder="Ej: Toyota"
        class="font-display flex h-11 w-full rounded-md border border-border bg-input px-3 py-2 text-sm placeholder:text-muted-foreground/60 transition-all duration-300 focus:border-primary/60 focus:bg-background focus:outline-none focus:ring-2 focus:ring-ring/50 focus:ring-offset-2 focus:ring-offset-background"
      />
      @if (isInvalid('marca')) {
      <div class="flex items-center gap-2 text-red-600 text-xs mt-1">
        <span class="material-symbols-outlined text-sm">error</span>
        <span>Marca es requerida.</span>
      </div>
      }
    </div>

    <!-- Modelo -->
    <div class="space-y-2 input-field">
      <label
        for="modelo"
        class="flex items-center gap-2 font-display text-sm font-medium leading-none text-muted-foreground transition-colors duration-300"
      >
        <span class="material-symbols-outlined text-lg transition-all duration-300">rv_hookup</span>
        Modelo
      </label>
      <input
        id="modelo"
        type="text"
        pInputText
        formControlName="modelo"
        placeholder="Ej: Hilux"
        class="font-display flex h-11 w-full rounded-md border border-border bg-input px-3 py-2 text-sm placeholder:text-muted-foreground/60 transition-all duration-300 focus:border-primary/60 focus:bg-background focus:outline-none focus:ring-2 focus:ring-ring/50 focus:ring-offset-2 focus:ring-offset-background"
      />
      @if (isInvalid('modelo')) {
      <div class="flex items-center gap-2 text-red-600 text-xs mt-1">
        <span class="material-symbols-outlined text-sm">error</span>
        <span>Modelo es requerido.</span>
      </div>
      }
    </div>

    <!-- Año -->
    <div class="space-y-2 input-field">
      <label
        for="anio"
        class="flex items-center gap-2 font-display text-sm font-medium leading-none text-muted-foreground transition-colors duration-300"
      >
        <span class="material-symbols-outlined text-lg transition-all duration-300"
          >calendar_today</span
        >
        Año
      </label>
      <input
        id="anio"
        type="number"
        pInputText
        formControlName="anio"
        placeholder="Ej: 2023"
        class="font-display flex h-11 w-full rounded-md border border-border bg-input px-3 py-2 text-sm placeholder:text-muted-foreground/60 transition-all duration-300 focus:border-primary/60 focus:bg-background focus:outline-none focus:ring-2 focus:ring-ring/50 focus:ring-offset-2 focus:ring-offset-background"
      />
      @if (isInvalid('anio')) {
      <div class="flex items-center gap-2 text-red-600 text-xs mt-1">
        <span class="material-symbols-outlined text-sm">error</span>
        <span>Año es requerido.</span>
      </div>
      }
    </div>

    <!-- Estado -->
    <div class="space-y-2 input-field">
      <label
        for="activo"
        class="flex items-center gap-2 font-display text-sm font-medium leading-none text-muted-foreground transition-colors duration-300"
      >
        <span class="material-symbols-outlined text-lg transition-all duration-300">toggle_on</span>
        Estado
      </label>
      <p-select
        id="activo"
        formControlName="activo"
        [options]="statusOptions"
        optionLabel="label"
        placeholder="Seleccione un estado"
        dataKey="value"
        styleClass="w-full h-11 rounded-md"
      ></p-select>
      @if (isInvalid('activo')) {
      <div class="flex items-center gap-2 text-red-600 text-xs mt-1">
        <span class="material-symbols-outlined text-sm">error</span>
        <span>Estado es requerido.</span>
      </div>
      }
    </div>

    <!-- Driver -->
    <div class="space-y-2 input-field">
      <label
        for="driver"
        class="flex items-center gap-2 font-display text-sm font-medium leading-none text-muted-foreground transition-colors duration-300"
      >
        <span class="material-symbols-outlined text-lg transition-all duration-300"
          >person_pin</span
        >
        Conductor Asignado (Opcional)
      </label>
      <p-autoComplete
        id="driver"
        formControlName="driver"
        [suggestions]="filteredDrivers()"
        (completeMethod)="searchDrivers($event)"
        (onClear)="onDriverClear()"
        field="nombre"
        placeholder="Buscar Conductor"
        [dropdown]="true"
        [forceSelection]="false"
        [showClear]="true"
        [dataKey]="'id'"
        [optionLabel]="'nombre'"
        styleClass="w-full"
        inputStyleClass="font-display flex h-11 w-full rounded-md border border-border bg-input px-3 py-2 text-sm placeholder:text-muted-foreground/60 transition-all duration-300 focus:border-primary/60 focus:bg-background focus:outline-none focus:ring-2 focus:ring-ring/50 focus:ring-offset-2 focus:ring-offset-background"
      >
        <ng-template let-driver pTemplate="item">
          <div class="flex flex-col p-2">
            <div class="font-bold text-foreground">{{ driver.nombre }}</div>
            <div class="text-sm text-muted-foreground">Licencia: {{ driver.licencia }}</div>
            <div class="text-xs text-muted-foreground">ID: {{ driver.id }}</div>
          </div>
        </ng-template>
        <ng-template let-driver pTemplate="selectedItem">
          {{ driver?.nombre }}
        </ng-template>
      </p-autoComplete>
      @if (isInvalid('driver')) {
      <div class="flex items-center gap-2 text-red-600 text-xs mt-1">
        <span class="material-symbols-outlined text-sm">error</span>
        <span>Selección de conductor inválida.</span>
      </div>
      }
    </div>
  </div>

  <div class="flex items-center justify-end gap-4 pt-6 border-t border-border">
    <button
      type="button"
      (click)="onCancel()"
      [disabled]="isLoading()"
      class="font-display inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 text-accent-foreground hover:bg-accent h-11 px-6 py-2"
    >
      Cancelar
    </button>
    <button
      type="submit"
      [disabled]="!canSubmit()"
      class="font-display inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-semibold tracking-wide ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 text-primary-foreground h-11 px-8 py-2 bg-primary hover:bg-primary/90 active:scale-[0.98] shadow-lg shadow-primary/20 hover:shadow-glow-primary-lg"
    >
      <span *ngIf="isLoading()" class="pi pi-spin pi-spinner" style="margin-right: 0.5rem"></span>
      {{ submitButtonLabel() }}
    </button>
  </div>
</form>
